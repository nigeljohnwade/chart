<html>
    <head>
        <script src="js/d3.min.js"></script>
        <script src="js/chroma.min.js"></script>
        <link rel="stylesheet" href="material.css">
        <style>
        *{
            box-sizing: border-box;
        }
        div.chartContainer{
            height: 500px;
            overflow-y: auto;
        }
        svg.chart{
            margin: auto;
            display: block;
        }
        div.inputs{
            position: absolute;
            right: 0;
            top: 0;
            width: 300px;
        }
        div.inputs > *{
            display: block
        }
        div.inputs textarea{
            width: 100%
        }
        div.swatchContainer, div.currentPaletteContainer {
            position: absolute;
            top: 0;
            left: 0;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.5);
        }
        div.currentPaletteContainer{
            top: 520px;
            width: 100%;
            text-align: center;
        }
        div.swatchContainer > span, div.currentPaletteContainer > span{
            display:block;
            margin-bottom: 8px;
        }
        div.swatchContainer div.swatch, div.currentPaletteContainer div.swatch{
            width: 32px;
            height: 32px;
            display: inline-block;
            vertical-align: bottom;
        }
        div.currentPaletteContainer div.swatch{
            width: 128px;
            height: 128px;
        }
        div.printablePaletteContainer{
            position: absolute;
            text-align: center;
            width: 100%;
            top: 0;
            background-color: white;
        }
        div.printablePaletteContainer ul{
            width: 24%;
            display: inline-block;
        }
        div.printablePaletteContainer ul li{
            list-style-type: none;
            text-align: center;
            padding:32px;
        }
        div.printablePaletteContainer ul li.swatch{
            height: 128px;
        }
        </style>
    </head>
    <body>
        <div class="chartContainer">
            <svg class="chart column-chart">
            </svg>
            <svg class="chart pie-chart">
            </svg>
        </div>
        <div class="inputs">
            <label>Use brewer colours
                <input type="radio" id="useBrewer" name="sourceSelector" checked onchange="drawChart()">
            </label>
            <label>Use brewer pastel colours
                <input type="radio" id="useBrewerPastel" name="sourceSelector" onchange="drawChart()">
            </label>
            <label>Use brewer short and extend
                <input type="radio" id="useBrewerShort" name="sourceSelector" onchange="drawChart()">
            </label>
            <label>Use brand and extend
                <input type="radio" id="useBrand" name="sourceSelector" onchange="drawChart()">
            </label>
            <label>Use JS array string
                <input type="radio" id="useJsArray" name="sourceSelector" onchange="drawChart()">
            </label>
            <textarea id="jsArray" name="jsArray"></textarea>
            <label>Use randomise
                <input type="checkbox" id="useRandom" name="options" onchange="drawChart()">
            </label>
            <label>Use extend
                <input type="checkbox" id="useExtend" name="options" onchange="drawChart()">
            </label>
            <input type="button" id="storePalette" onclick="storePalette()" value="Store Palette">
            <input type="button" id="clearPalettes" onclick="clearPalettes()" value="Clear Palettes">
            <input type="button" id="togglePalettes" onclick="togglePalettes()" value="Toggle Palettes">
            <input type="button" id="openPrintablePalette" onclick="togglePrintablePalette()" value="Open Printable Palette">
            <input type="button" id="drawChart" onclick="drawChart()" value="Draw Chart">
        </div>
        <div class="swatchContainer" style="display:none">
        </div>
        <div class="currentPaletteContainer">
        </div>
        <div class="printablePaletteContainer" style="display:none;">
        <input type="button" id="closePrintablePalette" onclick="togglePrintablePalette()" value="Close Printable Palette">
            <div class="palette">
            </div>
        </div>
        <script>
        var data = [5,6,2,7,4,9,7,2,1,4,5,6,8,5,4,3,5,7,3,7,5,4,8,5,2,3,1,8];
        var MaterialColors = ['red', 'pink', 'purple', 'deep-purple', 'indigo', 'blue',
            'light-blue', 'cyan', 'teal', 'green', 'light-green', 'lime',
            'yellow', 'amber', 'orange', 'deep-orange', 'brown', 'blue-grey'];
        var brewerColors = [
            '#1f78b4','#33a02c','#e31a1c','#ff7f00','#6a3d9a','#b15928',
            '#62a3d0','#72bf5b','#ef5a5a','#fe9f37','#9a77b8','#d8ac60',
            '#a6cee3','#b2df8a','#fb9a99','#fdbf6f','#cab2d6','#ffff99'
            ];  
        var brewerShort = [
            '#1f78b4','#33a02c','#e31a1c','#ff7f00','#6a3d9a','#b15928'
            ]
        var brewerPastel = [
            '#8dd3c7','#ffffb3','#bebada','#fb8072','#80b1d3','#fdb462',
            '#b3de69','#fccde5','#d9d9d9','#bc80bd','#ccebc5','#ffed6f']
        var shuffledRandom = [
            ["#b2df8a", "#fb9a99", "#ffff99", "#cab2d6", "#a6cee3", "#fdbf6f", "#e31a1c", "#1f78b4", "#b15928", "#ff7f00", "#6a3d9a", "#33a02c"]
        ];
        var brandColors = [
            '#48D5B5', '#21314d', '#FF585F', '#6e6e6e'
        ]

        var colors = brewerColors;

        function drawChart(){
            if(document.querySelector('#useJsArray').checked && document.querySelector('#jsArray').value.length > 0){
                colors = eval(document.querySelector('#jsArray').value);
                if(document.querySelector('#useRandom').checked){
                    colors = shuffleArray(colors);
                }
                if(document.querySelector('#useExtend').checked){
                    colors = extendPalette(colors, 0.3, 2);
                }
            }else if (document.querySelector('#useBrewer').checked){
                colors = brewerColors;
                if(document.querySelector('#useRandom').checked){
                    colors = shuffleArray(colors);
                }
            }else if (document.querySelector('#useBrewerPastel').checked){
                colors = brewerPastel;
                if(document.querySelector('#useRandom').checked){
                    colors = shuffleArray(colors);
                }
            }else if (document.querySelector('#useBrewerShort').checked){
                colors = brewerShort;
                if(document.querySelector('#useRandom').checked){
                    colors = shuffleArray(colors);
                }
                colors = extendPalette(colors, 0.3, 2);
            }else if (document.querySelector('#useBrand').checked){
                colors = brandColors;
                if(document.querySelector('#useRandom').checked){
                    colors = shuffleArray(colors);
                }
                colors = extendPalette(colors, 0.2, 3);
            }

            var _data = data.slice(0, colors.length)
            drawLineChart(_data);
            drawPieChart(_data);
            showCurrentPalette();
            printablePalette();
        }
        
        function drawLineChart(data){
            var width = 960,
                height = 500,
                radius = Math.min(width, height) / 2;

            var y = d3.scale.linear()
                .range([height, 0]);

            var chart = d3.select("svg.column-chart")
                .attr("width", width)
                .attr("height", height)
                .html("");
                
            y.domain([0, d3.max(data)]);
            var barWidth = width / data.length;
            var bar = chart.selectAll("g")
                .data(data)
                .enter().append("g")
                .attr("transform", function(d, i) {
                    return "translate(" + i * barWidth + ",0)"; 
                });
                
            bar.append("rect")
                .attr("y", function(d) { 
                    return y(d); 
                    })
                .attr("height", function(d) {
                    return height - y(d); 
                    })
                .attr("width", barWidth - 1)
                .attr("fill", function(d,i){
                    return colors[i];
                    }
                );
        }
        function drawPieChart(data){
            var width = 960,
                height = 500,
                radius = Math.min(width, height) / 2;
            var arc = d3.svg.arc()
                .outerRadius(radius - 10)
                .innerRadius(0);
            var pie = d3.layout.pie()
                .sort(null)
                .value(function(d) { 
                    return d;
                });
            var chart = d3.select("svg.pie-chart")
                .attr("width", width)
                .attr("height", height)
              .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
            var g = chart.selectAll(".arc")
                .data(pie(data))
                .enter().append("g")
                .attr("class", "arc");
            g.append("path")
                .attr("d", arc)
                .style("fill", function(d,i) {
                    return colors[i]; 
                });
        }

        var Storage = window.localStorage;
        var myPalettes = {};
        initPalettes();
        console.log(myPalettes);
        buildPalettes();
        
        function shuffleArray(arrayToShuffle){
            var _tempArray = arrayToShuffle.slice(0),
                _returnArray = [];
            for (var i = 0 ; _tempArray.length > 0 ; i++){
                _elemNumber = Math.floor(Math.random() * _tempArray.length);
                _returnArray[i] = _tempArray.splice(_elemNumber,1)[0];
            }
            console.log(_returnArray);
            return _returnArray;
        }
        function extendPalette(palette, step, count){
            var _returnPalette = palette.slice(0);
            for(var j = 0 ; j < count ; j++){
                for(var i = 0 ; i < palette.length ; i++){
                    _returnPalette.push(chroma.mix(palette[i], '#fff', step * (j + 1)).hex())
                }
            }
            /*for(var i = 0 ; i < palette.length ; i++){
                _returnPalette.push(chroma.mix(palette[i], '#fff', 0.6))
            }*/
            console.log(_returnPalette);
            return _returnPalette;
        }
        function initPalettes(){
            //test for stored palettes
            var storedPalettes = JSON.parse(Storage.getItem('MyPalettes'));
            if (storedPalettes && storedPalettes.palettes && storedPalettes.palettes.length > 0) {
                //stored palettes, retreive them
                retreivePalettes();
            }else if(!myPalettes.palettes){
                //no palettes, populate with brewer
                myPalettes = {palettes: [brewerColors]};
                storePalettes();
            }
            printablePalette();
        }
        function retreivePalettes(){
            myPalettes = JSON.parse(Storage.getItem('MyPalettes'));
        }
        function storePalette(){
            myPalettes.palettes.push(colors.slice(0));
            storePalettes();
        }
        function storePalettes(){
            Storage.setItem('MyPalettes', JSON.stringify(myPalettes));
            console.log(JSON.parse(Storage.getItem('MyPalettes')));
            buildPalettes();
        }
        function togglePalettes(){
            var _swatchContainer = document.querySelector('.swatchContainer');
            style = window.getComputedStyle(_swatchContainer),
            display = style.getPropertyValue('display');
            if(display === 'none'){
                _swatchContainer.setAttribute('style', 'display: block');
            }else{
                _swatchContainer.setAttribute('style', 'display: none');
            }
        }
        function buildPalettes(){
            var _swatchContainer = document.querySelector('.swatchContainer');
            _swatchContainer.innerHTML = "";
            retreivePalettes();
            if(myPalettes && myPalettes.palettes){
                for(var i = 0 ; i< myPalettes.palettes.length ; i ++){
                    var _s = document.createElement('span');
                    document.querySelector('.swatchContainer').appendChild(_s);
                    var _current = myPalettes.palettes[i];
                    for(var j = 0 ; j < _current.length ; j++){
                        var _d = document.createElement('div');
                        _d.setAttribute('class', 'swatch');
                        _d.setAttribute('style', "background-color:" + _current[j]);
                        document.querySelectorAll('.swatchContainer span')[i].appendChild(_d);
                    }
                }
            }

        }
        function showCurrentPalette(){
            var _currentPaletteContainer = document.querySelector('.currentPaletteContainer');
            _currentPaletteContainer.innerHTML = "";
            var _s = document.createElement('span');
            document.querySelector('.currentPaletteContainer').appendChild(_s);
            for(var i = 0 ; i< colors.length ; i ++){
                var _d = document.createElement('div');
                _d.setAttribute('class', 'swatch');
                _d.setAttribute('style', "background-color:" + colors[i]);
                var _rgbString = "rgb(" + Math.round(chroma(colors[i]).rgb()[0]) + ', ' +  Math.round(chroma(colors[i]).rgb()[1]) + ', ' + Math.round(chroma(colors[i]).rgb()[2]) + ')';
                var _hslString = "hsl(" + (isNaN(Math.round(chroma(colors[i]).hsl()[0])) ? '0' : Math.round(chroma(colors[i]).hsl()[0]) ) + ', ' + Math.round(chroma(colors[i]).hsl()[1] * 100) + '%, ' + Math.round(chroma(colors[i]).hsl()[2] * 100) + '%)';
                var _hexString = chroma(colors[i]).hex();
                _d.innerHTML = '<p>' + _hexString + '</p><p>' + _rgbString + ' </p><p>' + _hslString + ' </p>';
                document.querySelector('.currentPaletteContainer span').appendChild(_d);
            }
        }
        function printablePalette(){
            var _paletteContainer = document.querySelector('.printablePaletteContainer .palette');
            _paletteContainer.innerHTML = "";
            for( var j = 0 ; j < 4 ; j++){
                var _l = document.createElement('ul');
                for(var i = 0 ; i< colors.length ; i ++){
                    var _colorString;
                    var _li = document.createElement('li');
                    _li.setAttribute('class', 'swatch');
                    _li.setAttribute('style', "background-color:" + colors[i]);
                    switch(j){
                        case 0:
                            _colorString = chroma(colors[i]).hex();
                            break;
                        case 1:
                            _colorString = "rgb(" + Math.round(chroma(colors[i]).rgb()[0]) + ', ' +  Math.round(chroma(colors[i]).rgb()[1]) + ', ' + Math.round(chroma(colors[i]).rgb()[2]) +  ')';
                            break;
                        case 2:
                            var _colorString = "hsl(" + (isNaN(Math.round(chroma(colors[i]).hsl()[0])) ? '0' : Math.round(chroma(colors[i]).hsl()[0]) ) + ', ' + Math.round(chroma(colors[i]).hsl()[1] * 100) + '%, ' + Math.round(chroma(colors[i]).hsl()[2] * 100) + '%)';
                            break;  
                        case 3:
                            _colorString = '&ltCOLOR R="' + Math.round(chroma(colors[i]).rgb()[0]) + '" G="' +  Math.round(chroma(colors[i]).rgb()[1]) + '" B="' + Math.round(chroma(colors[i]).rgb()[2]) +  '" A="255" /&gt;';
                            break;                            
                    }
                    _li.innerHTML = '<p>' + _colorString + '</p>';
                    _l.appendChild(_li);
                }
                _paletteContainer.appendChild(_l);        
            }
        }
        function togglePrintablePalette(){
            var _printablePaletteContainer = document.querySelector('.printablePaletteContainer');
            style = window.getComputedStyle(_printablePaletteContainer),
            display = style.getPropertyValue('display');
            if(display === 'none'){
                _printablePaletteContainer.setAttribute('style', 'display: block');
            }else{
                _printablePaletteContainer.setAttribute('style', 'display: none');
                printablePalette();
            }
        }
        function clearPalettes(){
            myPalettes = {palettes: []};
            Storage.setItem('MyPalettes', JSON.stringify(myPalettes));
            buildPalettes();
        }
        </script>
    </body>
</html>